### Change the TS_SAL_ROOT and OSPL_HOME to the actual locations and uncomment
###
### export TS_SAL_ROOT=/home/saluser
### export OSPL_HOME=$TS_SAL_ROOT/OpenSpliceDDS/V6.9/HDE/x86_64.linux
###
### export PYTHON_BUILD_VERSION=3.6m
### export PYTHON_BUILD_LOCATION=/usr/local
### export PYTHON_INCLUDE_DIR=/usr/local/include/python3.6m
### export PYTHON_LIBRARY_DIR=/usr/lib64
###
### export LSST_DDS_DOMAIN=citest
###

if [ -z "$TS_SAL_ROOT" ]; then
    echo "Please edit setup.env to set TS_SAL_ROOT and OSPL_HOME environment variables"
    echo "to the locations where ts_sal and ts_opensplice have been installed."
    return 1
fi
if [ -z "$OSPL_HOME" ]; then
    echo "Please edit setup.env to set OSPL_HOME environment variable"
    return 1
fi
if [ -z "$PYTHON_BUILD_VERSION" ] && [ -z "$PYTHON_INCLUDE_DIR" ]; then
    echo "Please edit setup.env to set PYTHON_BUILD_VERSION and PYTHON_BUILD_LOCATION environment variable"
    echo "or set PYTHON_INCLUDE_DIR and PYTHON_LIBRARY_DIR to point to the appropriate directories"
    return 1
fi

export SAL_HOME=$TS_SAL_ROOT/lsstsal
export SAL_WORK_DIR=$TS_SAL_ROOT/test
if [ ! -z "$PYTHON_INCLUDE_DIR" ]; then
    cp $SAL_HOME/scripts/code/templates/Makefile.sacpp_SAL_pybind11.template2 $SAL_HOME/scripts/code/templates/Makefile.sacpp_SAL_pybind11.template
fi

### Do not use the DDS_DefaultQos unless you know this is what you want
### export LSST_DDS_QOS=file://${SAL_WORK_DIR}/DDS_DefaultQoS_All.xml
if [ ! -z "$LSST_DDS_QOS" ]; then
    XQOS=`echo ${LSST_DDS_QOS:7}`
    if [ -f "$XQOS" ]; then
      echo "Using DDS QOS from $XQOS"
    else
      echo "Please ensure LSST_DDS_QOS references an existing file"
      return 1
    fi
fi
export SAL_CPPFLAGS=-m64
source $SAL_HOME/salenv.sh
export JAVA_HOME=/etc/alternatives/java_sdk_openjdk
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:${SAL_HOME}/lib
export LD_PRELOAD=/etc/alternatives/java_sdk_openjdk/jre/lib/amd64/libjsig.so
export PATH=$JAVA_HOME/bin:${SAL_HOME}/bin:${TS_SAL_ROOT}/bin:${PATH}
export SAL_IDL_DIR=${SAL_WORK_DIR}/idl-templates/validated/sal
export PYTHONPATH=$PYTHONPATH:${SAL_WORK_DIR}/lib:${TS_SAL_ROOT}/python
export LSST_DDS_IP=`ip route get 1 | awk '{print $7;exit}'`
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:${SAL_WORK_DIR}/lib:${TS_SAL_ROOT}/lib
export TS_SAL_DIR=$TS_SAL_ROOT
export TS_XML_DIR=$TS_SAL_ROOT/../ts_xml
export RLM_HOME=$SAL_HOME/.m2/repository/org/opensplice/gateway/rlm/9.1.3
source $OSPL_HOME/release.com
mkdir -p $TS_SAL_ROOT/lsstsal/lib
sal_version=`cat $TS_SAL_ROOT/VERSION`
export SAL_VERSION=$sal_version
echo "LSST middleware toolset environment v"$sal_version" is configured"


